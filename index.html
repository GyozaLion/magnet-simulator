<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulator Generator Fisika Nyata (V4.0)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- DARK MODE THEME --- */
        body { background-color: #1a1a2e; color: #e6e6e6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Card & Containers */
        .card { 
            background-color: #16213e; 
            border: 1px solid #0f3460; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.4); 
            color: #fff;
        }
        
        /* Typography overrides */
        h1, h2, h3, h4, h5, h6 { color: #fff; }
        .text-muted { color: #a0a0a0 !important; }
        .text-secondary { color: #b0b0b0 !important; }
        label { color: #ddd; }
        
        /* Form Elements */
        .form-control, .form-select, .form-range { 
            background-color: #0f3460; 
            border: 1px solid #533483; 
            color: #fff; 
        }
        .form-control:focus, .form-select:focus { 
            background-color: #16213e; 
            border-color: #e94560; 
            color: #fff; box-shadow: none; 
        }

        /* Custom Colors */
        .text-accent { color: #e94560; }     /* Merah Pink - Highlights */
        .text-kinetic { color: #fcd34d; }    /* Kuning - Kinetic Energy */
        .text-input { color: #4ade80; }      /* Hijau - Input */
        
        /* Canvas */
        #animCanvas { background: #0f3460; border-radius: 10px; display: block; margin: 0 auto; border: 2px solid #533483; }

        /* Table */
        .table-custom { color: #fff; font-size: 0.85rem; }
        .table-custom td { border-color: #533483; padding: 4px 8px; }
        .metric-val { font-family: 'Courier New', monospace; font-weight: bold; }
    </style>
</head>
<body>

<div class="container-fluid py-3">
    <div class="row mb-3 text-center">
        <div class="col-12">
            <h2 class="fw-bold"><i class="fas fa-atom text-accent"></i> Simulator Generator & Inersia</h2>
            <p class="text-secondary small">Pembuktian Hukum Kekekalan Energi: Kinetik vs Listrik</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3">
            <div class="card p-3 mb-3">
                <h5 class="text-accent border-bottom pb-2"><i class="fas fa-cogs"></i> Setting Alat</h5>
                
                <div class="mb-3 mt-2">
                    <label class="small fw-bold">Berat Rotor (Flywheel Inertia)</label>
                    <select id="inertiaType" class="form-select form-select-sm">
                        <option value="0.05">Plastik Ringan (0.05 kg.m²)</option>
                        <option value="0.5" selected>Besi Solid (0.5 kg.m²) - Standar</option>
                        <option value="2.0">Roda Gila Berat (2.0 kg.m²)</option>
                    </select>
                    <div class="text-secondary small fst-italic" style="font-size: 0.7em;">
                        *Semakin berat, semakin lama berhenti (menyimpan energi).
                    </div>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold text-input">Input RPM Motor</label>
                    <input type="range" class="form-range" id="inputRPM" min="0" max="5000" step="100" value="3000">
                    <div class="d-flex justify-content-between small">
                        <span>0</span>
                        <span class="text-input fw-bold" id="rpmVal">3000 RPM</span>
                        <span>5000</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold">Beban Listrik (Ohm)</label>
                    <input type="number" class="form-control form-control-sm" id="loadResistance" value="20">
                    <div class="text-muted small" style="font-size: 0.7em;">Kecil = Beban Berat (Ampere Besar)</div>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button class="btn btn-success fw-bold" onclick="setMode('motor')">
                        <i class="fas fa-plug"></i> Sambung Motor (Input ON)
                    </button>
                    <button class="btn btn-danger fw-bold" onclick="setMode('free')">
                        <i class="fas fa-cut"></i> Cabut Motor (Free Energy?)
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="resetSim()">Reset</button>
                </div>
            </div>
            
            <div id="statusBox" class="alert alert-dark small text-center border-0">
                Status: <strong>Ready</strong>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card p-2 mb-3 text-center position-relative">
                <span class="position-absolute top-0 start-0 m-2 badge bg-dark border border-secondary">Visual Rotor</span>
                <canvas id="animCanvas" width="450" height="300"></canvas>
            </div>
            
            <div class="card p-2">
                <span class="badge bg-dark mb-1 align-self-start">Grafik Real-time</span>
                <canvas id="mainChart" style="max-height: 220px;"></canvas>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card p-3 h-100">
                <h5 class="text-accent border-bottom pb-2"><i class="fas fa-calculator"></i> Kalkulasi Fisika</h5>
                
                <table class="table table-custom table-borderless">
                    <tbody>
                        <tr>
                            <td colspan="2" class="text-secondary border-bottom border-secondary small fw-bold">KEADAAN ROTOR</td>
                        </tr>
                        <tr>
                            <td>Kecepatan</td>
                            <td class="text-end metric-val text-white" id="dispRPM">0 RPM</td>
                        </tr>
                        <tr>
                            <td>Energi Kinetik</td>
                            <td class="text-end metric-val text-kinetic" id="dispKinetik">0.0 J</td>
                        </tr>
                        
                        <tr>
                            <td colspan="2" class="text-secondary border-bottom border-secondary small fw-bold mt-2">OUTPUT LISTRIK</td>
                        </tr>
                        <tr>
                            <td>Daya (Watt)</td>
                            <td class="text-end metric-val text-success" id="dispWatt">0.0 W</td>
                        </tr>
                        <tr>
                            <td>Arus (Ampere)</td>
                            <td class="text-end metric-val text-info" id="dispAmp">0.0 A</td>
                        </tr>

                        <tr>
                            <td colspan="2" class="text-secondary border-bottom border-secondary small fw-bold mt-2">LOSS / PENGEREMAN</td>
                        </tr>
                        <tr>
                            <td>Torsi Magnet</td>
                            <td class="text-end metric-val text-danger" id="dispTorque">0.0 Nm</td>
                        </tr>
                        <tr>
                            <td>Total Power Loss</td>
                            <td class="text-end metric-val text-danger" id="dispTotalLoss">0.0 W</td>
                        </tr>
                        
                        <tr class="bg-dark border-top border-light">
                            <td class="py-2">Perlambatan</td>
                            <td class="text-end metric-val py-2 text-warning" id="dispDecel">0 RPM/s</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="small fst-italic text-muted mt-2 border-top pt-2" id="explanationText">
                    Rumus: Energi Kinetik habis dimakan oleh Power Loss (Listrik + Gesek).
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- KONFIGURASI CHART ---
    Chart.defaults.color = '#ccc';
    Chart.defaults.borderColor = '#333';
    const ctx = document.getElementById('mainChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                { label: 'RPM', data: [], borderColor: '#fcd34d', borderWidth: 2, pointRadius: 0, yAxisID: 'y' },
                { label: 'Output (Watt)', data: [], borderColor: '#4ade80', borderWidth: 2, pointRadius: 0, yAxisID: 'y1' }
            ]
        },
        options: {
            responsive: true,
            animation: false,
            scales: {
                x: { display: false },
                y: { type: 'linear', display: true, position: 'left', title: {display:true, text:'RPM', color:'#fcd34d'} },
                y1: { type: 'linear', display: true, position: 'right', grid:{drawOnChartArea:false}, title: {display:true, text:'Watt', color:'#4ade80'} }
            },
            plugins: { legend: { labels: { font: { size: 10 } } } }
        }
    });

    // --- VARIABEL GLOBAL ---
    let timer = null;
    let mode = 'stop'; // 'stop', 'motor', 'free'
    
    // Variabel Fisika Dinamis
    let rpm = 0;
    let angle = 0;
    let targetRPM = 3000;
    
    // Konstanta
    const coilInternalR = 5; // Resistansi dalam kumparan (Ohm)
    const magnetStrength = 1.2; // Tesla
    const geometryFactor = 0.005; // Faktor konversi alat

    // --- FUNGSI FISIKA UTAMA (Jantung Simulasi) ---
    function updatePhysics() {
        // 1. Ambil Nilai Settingan
        const inertia = parseFloat(document.getElementById('inertiaType').value);
        const loadR = parseFloat(document.getElementById('loadResistance').value);
        const inputSlider = parseInt(document.getElementById('inputRPM').value);

        // Update Target jika mode Motor
        if (mode === 'motor') targetRPM = inputSlider;

        // 2. Hitung Listrik (Berdasarkan RPM saat ini)
        const omega = (rpm * 2 * Math.PI) / 60; // Kecepatan sudut (rad/s)
        
        // GGL Induksi (Volt) = Kecepatan * Kekuatan Magnet
        const voltage = rpm * magnetStrength * geometryFactor; 
        
        // Hukum Ohm: I = V / R_total
        const totalR = loadR + coilInternalR;
        const current = voltage / totalR;
        
        // Daya Listrik Output (Watt) = I² * R_load
        const wattsOut = current * current * loadR;
        
        // Daya Panas di Kabel (Loss) = I² * R_internal
        const wattsHeat = current * current * coilInternalR;

        // 3. Hitung GAYA LAWAN (Counter Torque / Torsi Pengereman)
        // Power = Torsi * Omega  =>  Torsi = Power / Omega
        // Total energi yang menyedot putaran = Output Listrik + Panas Kabel + Gesekan Udara
        const frictionLoss = 0.0005 * rpm * rpm * 0.01; // Gesekan aerodinamis (nambah kuadratik)
        const totalPowerDrain = wattsOut + wattsHeat + frictionLoss;
        
        let counterTorque = 0;
        if (omega > 1) {
            counterTorque = totalPowerDrain / omega; 
        }

        // 4. Update RPM (Hukum Newton Rotasi)
        let decelRPM = 0; // Berapa RPM turun per detik

        if (mode === 'motor') {
            // Jika Motor ON: Motor memberi tenaga untuk melawan Torsi Lawan
            // Kita buat efek "mengejar" target RPM (tidak instan)
            const diff = targetRPM - rpm;
            rpm += diff * 0.05; // Akselerasi motor
            
            // Efek getaran beban
            if(rpm > 0) rpm -= (counterTorque * 0.5); // Beban berat bikin motor drop dikit
            if(rpm < 0) rpm = 0;

        } else if (mode === 'free') {
            // Jika Free Energy (Motor Mati):
            // Satu-satunya gaya adalah Torsi Lawan (Pengereman)
            // Perlambatan (alpha) = Torsi / Inersia
            
            const alpha = counterTorque / inertia; // rad/s²
            
            // Kurangi Omega
            const dt = 0.05; // Delta time 50ms
            const newOmega = omega - (alpha * dt);
            
            // Hitung balik ke RPM
            const newRPM = (newOmega * 60) / (2 * Math.PI);
            
            // Hitung seberapa cepat dia turun (untuk display)
            decelRPM = (rpm - newRPM) / dt; // RPM per detik
            
            rpm = newRPM;
            if (rpm < 0) rpm = 0;
        }

        // 5. Energi Kinetik Tersimpan (1/2 I w²)
        const kineticEnergy = 0.5 * inertia * omega * omega;

        // --- UPDATE UI ---
        document.getElementById('dispRPM').innerText = rpm.toFixed(0) + " RPM";
        document.getElementById('dispKinetik').innerText = kineticEnergy.toFixed(1) + " J";
        document.getElementById('dispWatt').innerText = wattsOut.toFixed(1) + " W";
        document.getElementById('dispAmp').innerText = current.toFixed(2) + " A";
        document.getElementById('dispTorque').innerText = counterTorque.toFixed(2) + " Nm";
        document.getElementById('dispTotalLoss').innerText = totalPowerDrain.toFixed(1) + " W";
        
        // Logic Warna & Teks Perlambatan
        const elDecel = document.getElementById('dispDecel');
        if (mode === 'free' && rpm > 1) {
            elDecel.innerText = "-" + decelRPM.toFixed(0) + " RPM/s";
            elDecel.className = "text-end metric-val py-2 text-danger blink";
            document.getElementById('explanationText').innerHTML = 
                `Peringatan: Energi Kinetik sedang dikuras sebesar <strong>${totalPowerDrain.toFixed(0)} Joule/detik</strong>.`;
        } else if (mode === 'motor') {
            elDecel.innerText = "Stabil (Driven)";
            elDecel.className = "text-end metric-val py-2 text-success";
            document.getElementById('explanationText').innerText = "Motor menyuplai energi terus menerus.";
        } else {
            elDecel.innerText = "0 RPM/s";
            document.getElementById('explanationText').innerText = "Sistem Berhenti.";
        }

        // Animasi & Chart
        angle += omega * 0.05;
        drawGen(angle, current);
        updateChart(rpm, wattsOut);

        if (mode === 'free' && rpm < 1) {
            mode = 'stop';
            document.getElementById('statusBox').innerHTML = "Rotor Kehabisan Energi. Berhenti.";
            document.getElementById('statusBox').className = "alert alert-danger small text-center";
        }
    }

    // --- VISUALISASI ---
    function drawGen(ang, curr) {
        const c = document.getElementById('animCanvas');
        const x = c.getContext('2d');
        const w = c.width, h = c.height;
        
        x.clearRect(0,0,w,h);
        
        // Stator
        x.beginPath(); x.arc(w/2, h/2, 80, 0, 7);
        x.lineWidth = 15; x.strokeStyle = '#444'; x.stroke();
        
        // Coil Glow effect
        const opacity = Math.min(curr/5, 1);
        x.fillStyle = `rgba(74, 222, 128, ${opacity})`; // Hijau nyala
        x.shadowBlur = opacity * 30; x.shadowColor = "#4ade80";
        x.fillRect(w/2 - 110, h/2 - 30, 30, 60); // Kiri
        x.fillRect(w/2 + 80, h/2 - 30, 30, 60);  // Kanan
        x.shadowBlur = 0; // Reset

        // Rotor
        x.save();
        x.translate(w/2, h/2);
        x.rotate(ang);
        
        // Flywheel Body
        x.fillStyle = '#666'; 
        x.beginPath(); x.arc(0,0, 60, 0, 7); x.fill();
        
        // Magnet N/S
        x.fillStyle = '#e94560'; x.fillRect(0, -20, 55, 40); // N
        x.fillStyle = '#fff'; x.fillText('N', 30, 5);
        x.fillStyle = '#3f72af'; x.fillRect(-55, -20, 55, 40); // S
        x.fillStyle = '#fff'; x.fillText('S', -30, 5);
        
        x.restore();
    }

    let tick = 0;
    function updateChart(r, w) {
        tick++;
        if(tick % 5 === 0) { // Update tiap 5 frame biar ringan
            chart.data.labels.push('');
            chart.data.datasets[0].data.push(r);
            chart.data.datasets[1].data.push(w);
            if(chart.data.labels.length > 50) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
                chart.data.datasets[1].data.shift();
            }
            chart.update();
        }
    }

    // --- KONTROL ---
    function setMode(m) {
        mode = m;
        const status = document.getElementById('statusBox');
        if(m === 'motor') {
            status.innerHTML = "Mode: <strong>MOTOR ON</strong>. Energi disuplai dari luar.";
            status.className = "alert alert-success small text-center";
            if(rpm < 100) rpm = 100;
        } else {
            status.innerHTML = "Mode: <strong>FREE ENERGY TEST</strong>. Input OFF. Menggunakan sisa Inersia.";
            status.className = "alert alert-warning small text-center";
        }
    }
    
    function resetSim() {
        mode = 'stop';
        rpm = 0;
        chart.data.labels = [];
        chart.data.datasets.forEach(d => d.data = []);
        chart.update();
        drawGen(0,0);
        document.getElementById('dispRPM').innerText = "0 RPM";
    }

    document.getElementById('inputRPM').addEventListener('input', function(e) {
        document.getElementById('rpmVal').innerText = e.target.value + " RPM";
    });

    // Start Loop
    setInterval(updatePhysics, 50);

</script>
</body>
</html>
