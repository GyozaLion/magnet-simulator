<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulator Ilmiah Generator Magnet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); border: none; }
        .metric-box { padding: 15px; border-radius: 8px; text-align: center; color: white; margin-bottom: 10px; }
        .bg-input { background-color: #3498db; } /* Input Power - Blue */
        .bg-output { background-color: #2ecc71; } /* Output Power - Green */
        .bg-loss { background-color: #e74c3c; }   /* Heat/Friction - Red */
        #simulationCanvas { max-height: 300px; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1>Simulator Fisika Generator Magnet</h1>
            <p class="text-muted">Simulasi berdasarkan Hukum Termodinamika, Hukum Faraday, dan Hukum Lenz.</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card p-4 mb-3">
                <h4>Parameter Generator</h4>
                <hr>
                
                <div class="mb-3">
                    <label class="form-label">Tipe Magnet (Kekuatan Medan/B)</label>
                    <select id="magnetType" class="form-select">
                        <option value="0.2">Ferrite (Lemah - 0.2 Tesla)</option>
                        <option value="1.2" selected>Neodymium N52 (Kuat - 1.2 Tesla)</option>
                        <option value="2.0">Experimental Super Magnet (2.0 Tesla)</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Jumlah Lilitan Kumparan (N)</label>
                    <input type="range" class="form-range" id="coilTurns" min="100" max="2000" step="100" value="500">
                    <div class="text-end small" id="coilVal">500 Lilitan</div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Hambatan Beban (Lampu/Load)</label>
                    <input type="number" class="form-control" id="loadResistance" value="10">
                    <div class="form-text">Ohm (Semakin kecil, beban makin berat)</div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Gesekan Poros (Friction)</label>
                    <select id="frictionType" class="form-select">
                        <option value="0.05">Bering Keramik (Licin)</option>
                        <option value="0.2" selected>Bering Standar</option>
                        <option value="0.5">Bering Kasar/Rusak</option>
                    </select>
                </div>

                <hr>
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="startSimulation(true)">Jalankan dengan Input Motor (Normal)</button>
                    <button class="btn btn-danger" onclick="startSimulation(false)">Jalankan Mode "Free Energy" (Tanpa Input)</button>
                    <button class="btn btn-secondary" onclick="resetSim()">Reset</button>
                </div>
            </div>
            
            <div class="alert alert-info small">
                <strong>Catatan Fisika:</strong> 
                <br>Menurut <em>Hukum Lenz</em>, saat arus listrik dihasilkan, ia menciptakan medan magnet yang <strong>berlawanan</strong> arah dengan putaran rotor. Ini menciptakan pengereman magnetik.
            </div>
        </div>

        <div class="col-md-8">
            <div class="row mb-3">
                <div class="col-md-4">
                    <div class="metric-box bg-input">
                        <h5>Input Power</h5>
                        <h3 id="inputPowerDisplay">0 W</h3>
                        <small>Tenaga yang dibutuhkan untuk memutar</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-box bg-output">
                        <h5>Output Power</h5>
                        <h3 id="outputPowerDisplay">0 W</h3>
                        <small>Listrik yang dihasilkan</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-box bg-loss">
                        <h5>Total Loss</h5>
                        <h3 id="lossDisplay">0 W</h3>
                        <small>Panas & Gesekan (Hukum Termodinamika II)</small>
                    </div>
                </div>
            </div>

            <div class="card p-3">
                <canvas id="simulationCanvas"></canvas>
            </div>
            
            <div class="mt-3 p-3 bg-white border rounded">
                <h5>Analisa Real-Time:</h5>
                <ul id="analysisLog" class="small text-muted" style="list-style: none; padding-left: 0;">
                    <li>Menunggu simulasi dimulai...</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    // Inisialisasi Chart
    const ctx = document.getElementById('simulationCanvas').getContext('2d');
    let chart;
    let simulationInterval;
    let time = 0;
    
    // Variabel Fisika
    let currentRPM = 0;
    const rotorInertia = 0.5; // kg.m^2 (Inersia massa rotor)

    function initChart() {
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'RPM Rotor', data: [], borderColor: 'blue', fill: false },
                    { label: 'Output Listrik (Watt)', data: [], borderColor: 'green', fill: false }
                ]
            },
            options: {
                animation: false,
                scales: { x: { title: { display: true, text: 'Waktu (detik)' } } }
            }
        });
    }

    // Update slider value display
    document.getElementById('coilTurns').addEventListener('input', function(e) {
        document.getElementById('coilVal').innerText = e.target.value + " Lilitan";
    });

    function resetSim() {
        clearInterval(simulationInterval);
        initChart();
        time = 0;
        currentRPM = 0;
        updateDisplay(0, 0, 0);
        document.getElementById('analysisLog').innerHTML = "<li>Simulasi di-reset.</li>";
    }

    function startSimulation(hasExternalInput) {
        resetSim();
        currentRPM = 3000; // Start initial speed
        
        const B = parseFloat(document.getElementById('magnetType').value); // Tesla
        const N = parseInt(document.getElementById('coilTurns').value); // Lilitan
        const R_load = parseFloat(document.getElementById('loadResistance').value); // Ohm
        const frictionCoeff = parseFloat(document.getElementById('frictionType').value);
        
        // Asumsi Area kumparan (A)
        const A = 0.01; // m^2
        const R_internal = N * 0.01; // Internal resistance kawat tembaga
        const R_total = R_load + R_internal;

        document.getElementById('analysisLog').innerHTML = `
            <li><strong>Mulai Simulasi:</strong> ${hasExternalInput ? "Motor Penggerak ON" : "Magnet Statis Only (Mode 'Free Energy')"}</li>
            <li>Magnet: ${B} Tesla | Beban: ${R_load} Ohm</li>
        `;

        simulationInterval = setInterval(() => {
            time += 0.1;
            
            // 1. Kalkulasi Gaya Gerak Listrik (GGL) / Voltage
            // E = N * B * A * omega (Hukum Faraday)
            const omega = (currentRPM * 2 * Math.PI) / 60; // Rad/s
            const voltage = N * B * A * omega * 0.7; // 0.7 adalah faktor efisiensi geometri
            
            // 2. Kalkulasi Arus (I)
            const current = voltage / R_total;
            
            // 3. Kalkulasi Output Power (Listrik Berguna)
            const powerOut = current * current * R_load;
            
            // 4. Kalkulasi LOSS (Kunci Pembantahan)
            // A. Panas di kabel (I^2 * R_internal)
            const powerHeat = current * current * R_internal;
            
            // B. Counter Torque (Hukum Lenz) -> Torsi pengereman magnetik
            // Torque_magnetic = (k * I * B)
            // Power_magnetic_drag = Torque * omega
            const torqueMagnetic = (N * B * A * current) * 0.8; 
            const powerMagneticDrag = torqueMagnetic * omega;
            
            // C. Gesekan Mekanis
            const torqueFriction = frictionCoeff * (currentRPM / 1000);
            const powerFriction = torqueFriction * omega;
            
            const totalLoss = powerHeat + powerFriction;
            const totalDragPower = powerMagneticDrag + powerFriction; // Daya yang melawan putaran

            let powerIn = 0;

            if (hasExternalInput) {
                // Jika ada motor, motor memberikan tenaga sebesar drag untuk menjaga RPM stabil
                powerIn = totalDragPower + powerOut; 
                // RPM dijaga stabil (dengan sedikit fluktuasi random biar realistis)
                currentRPM = 3000 + (Math.random() * 50 - 25);
            } else {
                // JIKA MODE STATIC MAGNET (Free Energy Claims)
                // Input = 0. 
                // Energi diambil dari energi kinetik rotor.
                powerIn = 0;
                
                // Deselerasi: Torsi = I * alpha
                // alpha (perlamatan) = Torsi Total / Inersia
                const totalCounterTorque = torqueMagnetic + torqueFriction;
                const alpha = totalCounterTorque / rotorInertia;
                
                // Kurangi kecepatan sudut
                let newOmega = omega - (alpha * 0.1); // dt = 0.1s
                
                if (newOmega < 0) newOmega = 0;
                
                // Konversi balik ke RPM
                currentRPM = (newOmega * 60) / (2 * Math.PI);
            }

            // Update Grafik
            if (time % 0.5 < 0.1) { // Update chart tiap 0.5 detik simulasi
                chart.data.labels.push(time.toFixed(1));
                chart.data.datasets[0].data.push(currentRPM);
                chart.data.datasets[1].data.push(powerOut);
                
                if(chart.data.labels.length > 20) {
                    chart.data.labels.shift();
                    chart.data.datasets[0].data.shift();
                    chart.data.datasets[1].data.shift();
                }
                chart.update();
            }

            // Update Angka
            updateDisplay(powerIn, powerOut, totalLoss + powerMagneticDrag);

            // Logika berhenti jika RPM 0
            if (currentRPM <= 0.1 && !hasExternalInput) {
                clearInterval(simulationInterval);
                document.getElementById('analysisLog').innerHTML += `<li class="text-danger"><strong>Sistem Berhenti!</strong> Energi Kinetik habis terkuras oleh Hukum Lenz (Back EMF) dan Gesekan.</li>`;
                currentRPM = 0;
                updateDisplay(0, 0, 0);
            }

        }, 100); // 100ms real time = 0.1s simulation time
    }

    function updateDisplay(pin, pout, ploss) {
        document.getElementById('inputPowerDisplay').innerText = pin.toFixed(1) + " W";
        document.getElementById('outputPowerDisplay').innerText = pout.toFixed(1) + " W";
        document.getElementById('lossDisplay').innerText = ploss.toFixed(1) + " W";
    }

    // Init
    initChart();
</script>

</body>
</html>
