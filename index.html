<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulator Generator Fisika (V5.0 Komplit)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- DARK MODE THEME --- */
        body { background-color: #1a1a2e; color: #e6e6e6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Card & Containers */
        .card { 
            background-color: #16213e; 
            border: 1px solid #0f3460; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.4); 
            color: #fff;
        }
        
        /* Typography overrides */
        h1, h2, h3, h4, h5, h6 { color: #fff; }
        .text-muted { color: #a0a0a0 !important; }
        .text-secondary { color: #b0b0b0 !important; }
        label { color: #ddd; font-size: 0.85rem; }
        
        /* Form Elements */
        .form-control, .form-select, .form-range { 
            background-color: #0f3460; 
            border: 1px solid #533483; 
            color: #fff; 
        }
        .form-control:focus, .form-select:focus { 
            background-color: #16213e; 
            border-color: #e94560; 
            color: #fff; box-shadow: none; 
        }

        /* Custom Colors */
        .text-accent { color: #e94560; }     /* Merah Pink - Highlights */
        .text-kinetic { color: #fcd34d; }    /* Kuning - Kinetic Energy */
        .text-input { color: #4ade80; }      /* Hijau - Input */
        
        /* Canvas */
        #animCanvas { background: #0f3460; border-radius: 10px; display: block; margin: 0 auto; border: 2px solid #533483; }

        /* Table */
        .table-custom { color: #fff; font-size: 0.85rem; }
        .table-custom td { border-color: #533483; padding: 4px 8px; }
        .metric-val { font-family: 'Courier New', monospace; font-weight: bold; }
    </style>
</head>
<body>

<div class="container-fluid py-3">
    <div class="row mb-3 text-center">
        <div class="col-12">
            <h2 class="fw-bold"><i class="fas fa-atom text-accent"></i> Simulator Generator Lengkap</h2>
            <p class="text-secondary small">Eksperimen: Pengaruh Kekuatan Magnet terhadap Pengereman (Hukum Lenz)</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3">
            <div class="card p-3 mb-3">
                <h5 class="text-accent border-bottom pb-2"><i class="fas fa-cogs"></i> Spesifikasi Alat</h5>
                
                <div class="mb-2">
                    <label class="fw-bold">Tipe Magnet (Kekuatan)</label>
                    <select id="magnetType" class="form-select form-select-sm">
                        <option value="0.2">Ferrite Lemah (0.2 T)</option>
                        <option value="1.2" selected>Neodymium N52 (1.2 T)</option>
                        <option value="3.0">Super Magnet (3.0 T)</option>
                    </select>
                </div>

                <div class="mb-2">
                    <label class="fw-bold">Jumlah Lilitan (Coils)</label>
                    <input type="range" class="form-range" id="coilTurns" min="100" max="2000" step="100" value="1000">
                    <div class="text-end small text-info" id="coilVal">1000 Lilitan</div>
                </div>

                <hr class="border-secondary my-2">

                <div class="mb-2">
                    <label class="fw-bold">Berat Rotor (Inersia)</label>
                    <select id="inertiaType" class="form-select form-select-sm">
                        <option value="0.05">Plastik Ringan (Cepat Berhenti)</option>
                        <option value="0.5" selected>Besi Solid (Standar)</option>
                        <option value="2.0">Roda Gila Berat (Lama Berhenti)</option>
                    </select>
                </div>

                <div class="mb-2">
                    <label class="fw-bold text-input">Input RPM Motor</label>
                    <input type="range" class="form-range" id="inputRPM" min="0" max="5000" step="100" value="3000">
                    <div class="d-flex justify-content-between small">
                        <span>0</span>
                        <span class="text-input fw-bold" id="rpmVal">3000 RPM</span>
                        <span>5000</span>
                    </div>
                </div>

                <div class="mb-2">
                    <label class="fw-bold">Beban Listrik (Ohm)</label>
                    <input type="number" class="form-control form-control-sm" id="loadResistance" value="20">
                    <div class="text-muted small" style="font-size: 0.7em;">Semakin Kecil = Beban Makin Berat</div>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button class="btn btn-success fw-bold" onclick="setMode('motor')">
                        <i class="fas fa-plug"></i> Input Motor ON
                    </button>
                    <button class="btn btn-danger fw-bold" onclick="setMode('free')">
                        <i class="fas fa-cut"></i> Cabut Motor (Free Energy?)
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="resetSim()">Reset</button>
                </div>
            </div>
            
            <div id="statusBox" class="alert alert-dark small text-center border-0">
                Status: <strong>Ready</strong>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card p-2 mb-3 text-center position-relative">
                <span class="position-absolute top-0 start-0 m-2 badge bg-dark border border-secondary">Visual Rotor</span>
                <canvas id="animCanvas" width="450" height="300"></canvas>
            </div>
            
            <div class="card p-2">
                <span class="badge bg-dark mb-1 align-self-start">Grafik Real-time</span>
                <canvas id="mainChart" style="max-height: 220px;"></canvas>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card p-3 h-100">
                <h5 class="text-accent border-bottom pb-2"><i class="fas fa-calculator"></i> Kalkulasi Fisika</h5>
                
                <table class="table table-custom table-borderless">
                    <tbody>
                        <tr>
                            <td colspan="2" class="text-secondary border-bottom border-secondary small fw-bold">KEADAAN ROTOR</td>
                        </tr>
                        <tr>
                            <td>Kecepatan</td>
                            <td class="text-end metric-val text-white" id="dispRPM">0 RPM</td>
                        </tr>
                        <tr>
                            <td>Energi Kinetik</td>
                            <td class="text-end metric-val text-kinetic" id="dispKinetik">0.0 J</td>
                        </tr>
                        
                        <tr>
                            <td colspan="2" class="text-secondary border-bottom border-secondary small fw-bold mt-2">OUTPUT LISTRIK</td>
                        </tr>
                        <tr>
                            <td>Tegangan (Volt)</td>
                            <td class="text-end metric-val text-info" id="dispVolt">0.0 V</td>
                        </tr>
                        <tr>
                            <td>Daya (Watt)</td>
                            <td class="text-end metric-val text-success" id="dispWatt">0.0 W</td>
                        </tr>

                        <tr>
                            <td colspan="2" class="text-secondary border-bottom border-secondary small fw-bold mt-2">PENGEREMAN (LOSS)</td>
                        </tr>
                        <tr>
                            <td>Torsi Magnet (Lenz)</td>
                            <td class="text-end metric-val text-danger" id="dispTorque">0.0 Nm</td>
                        </tr>
                        <tr>
                            <td>Energi Terbuang/detik</td>
                            <td class="text-end metric-val text-danger" id="dispTotalLoss">0.0 W</td>
                        </tr>
                        
                        <tr class="bg-dark border-top border-light">
                            <td class="py-2">Perlambatan</td>
                            <td class="text-end metric-val py-2 text-warning" id="dispDecel">0 RPM/s</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="small fst-italic text-muted mt-2 border-top pt-2" id="explanationText">
                    Tips: Coba naikkan Lilitan & Magnet. Lihat 'Perlambatan' makin parah.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- KONFIGURASI CHART ---
    Chart.defaults.color = '#ccc';
    Chart.defaults.borderColor = '#333';
    const ctx = document.getElementById('mainChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                { label: 'RPM', data: [], borderColor: '#fcd34d', borderWidth: 2, pointRadius: 0, yAxisID: 'y' },
                { label: 'Output (Watt)', data: [], borderColor: '#4ade80', borderWidth: 2, pointRadius: 0, yAxisID: 'y1' }
            ]
        },
        options: {
            responsive: true,
            animation: false,
            scales: {
                x: { display: false },
                y: { type: 'linear', display: true, position: 'left', title: {display:true, text:'RPM', color:'#fcd34d'} },
                y1: { type: 'linear', display: true, position: 'right', grid:{drawOnChartArea:false}, title: {display:true, text:'Watt', color:'#4ade80'} }
            },
            plugins: { legend: { labels: { font: { size: 10 } } } }
        }
    });

    // --- VARIABEL GLOBAL ---
    let timer = null;
    let mode = 'stop'; 
    let rpm = 0;
    let angle = 0;
    let targetRPM = 3000;
    
    // Konstanta Area Kumparan
    const coilArea = 0.02; // m^2

    // --- FUNGSI FISIKA UTAMA ---
    function updatePhysics() {
        // 1. Ambil Nilai Settingan dari UI
        const inertia = parseFloat(document.getElementById('inertiaType').value);
        const magnetB = parseFloat(document.getElementById('magnetType').value); // Tesla
        const numTurns = parseInt(document.getElementById('coilTurns').value); // Jumlah Lilitan
        const loadR = parseFloat(document.getElementById('loadResistance').value);
        const inputSlider = parseInt(document.getElementById('inputRPM').value);

        if (mode === 'motor') targetRPM = inputSlider;

        // 2. Hitung Listrik (FARADAY LAW)
        // E = N * B * A * omega
        const omega = (rpm * 2 * Math.PI) / 60; // rad/s
        const voltageRaw = numTurns * magnetB * coilArea * omega * 0.7; // 0.7 efisiensi
        const voltageRMS = voltageRaw * 0.707; // DC Equivalent

        // Resistansi Total
        const internalR = numTurns * 0.01; // 0.01 ohm per lilitan
        const totalR = loadR + internalR;

        // Arus (Ohm's Law)
        const current = voltageRMS / totalR;
        
        // Daya Output (Watt)
        const wattsOut = current * current * loadR;
        const wattsHeat = current * current * internalR;

        // 3. Hitung PENGEREMAN (LENZ LAW)
        // Torsi Lawan Magnetik = Total Power / Omega
        // (Semakin besar watt yang dihasilkan, semakin berat putarannya)
        const frictionPower = 0.002 * rpm * rpm * 0.01; // Gesekan udara/bearing
        const totalPowerDrain = wattsOut + wattsHeat + frictionPower;
        
        let counterTorque = 0;
        if (omega > 1) {
            counterTorque = totalPowerDrain / omega;
        }

        // 4. Update Gerakan Rotor (NEWTON LAW)
        let decelRPM = 0;

        if (mode === 'motor') {
            // Mode Motor: Mengejar target RPM
            const diff = targetRPM - rpm;
            rpm += diff * 0.05; 
            if(rpm > 0) rpm -= (counterTorque * 0.5); // Beban bikin motor sedikit drop
            if(rpm < 0) rpm = 0;

        } else if (mode === 'free') {
            // Mode Free Energy: Murni deselerasi
            const alpha = counterTorque / inertia; // rad/sÂ²
            const dt = 0.05; 
            const newOmega = omega - (alpha * dt);
            
            const newRPM = (newOmega * 60) / (2 * Math.PI);
            decelRPM = (rpm - newRPM) / dt; 
            rpm = newRPM;
            if (rpm < 0) rpm = 0;
        }

        const kineticEnergy = 0.5 * inertia * omega * omega;

        // --- UPDATE UI ---
        document.getElementById('dispRPM').innerText = rpm.toFixed(0) + " RPM";
        document.getElementById('dispKinetik').innerText = kineticEnergy.toFixed(0) + " J";
        document.getElementById('dispVolt').innerText = voltageRMS.toFixed(1) + " V";
        document.getElementById('dispWatt').innerText = wattsOut.toFixed(1) + " W";
        document.getElementById('dispTorque').innerText = counterTorque.toFixed(2) + " Nm";
        document.getElementById('dispTotalLoss').innerText = totalPowerDrain.toFixed(0) + " W";
        
        const elDecel = document.getElementById('dispDecel');
        if (mode === 'free' && rpm > 10) {
            elDecel.innerText = "-" + decelRPM.toFixed(0) + " RPM/s";
            elDecel.className = "text-end metric-val py-2 text-danger blink";
        } else if (mode === 'motor') {
            elDecel.innerText = "Stabil";
            elDecel.className = "text-end metric-val py-2 text-success";
        } else {
            elDecel.innerText = "0";
        }

        // Animasi & Chart
        angle += omega * 0.05;
        drawGen(angle, current);
        updateChart(rpm, wattsOut);

        if (mode === 'free' && rpm < 5) {
            mode = 'stop';
            rpm = 0;
            document.getElementById('statusBox').innerHTML = "Energi Habis. Rotor Berhenti.";
            document.getElementById('statusBox').className = "alert alert-danger small text-center";
        }
    }

    // --- VISUALISASI ---
    function drawGen(ang, curr) {
        const c = document.getElementById('animCanvas');
        const x = c.getContext('2d');
        const w = c.width, h = c.height;
        x.clearRect(0,0,w,h);
        
        // Stator
        x.beginPath(); x.arc(w/2, h/2, 80, 0, 7);
        x.lineWidth = 15; x.strokeStyle = '#444'; x.stroke();
        
        // Coil Glow effect
        const opacity = Math.min(curr/5, 1);
        x.fillStyle = `rgba(74, 222, 128, ${opacity})`; 
        x.shadowBlur = opacity * 30; x.shadowColor = "#4ade80";
        x.fillRect(w/2 - 110, h/2 - 30, 30, 60); 
        x.fillRect(w/2 + 80, h/2 - 30, 30, 60);  
        x.shadowBlur = 0; 

        // Rotor
        x.save();
        x.translate(w/2, h/2);
        x.rotate(ang);
        
        // Magnet Body
        x.fillStyle = '#777'; 
        x.beginPath(); x.arc(0,0, 60, 0, 7); x.fill();
        x.fillStyle = '#e94560'; x.fillRect(0, -20, 58, 40); // N
        x.fillStyle = '#fff'; x.fillText('N', 30, 5);
        x.fillStyle = '#3f72af'; x.fillRect(-58, -20, 58, 40); // S
        x.fillStyle = '#fff'; x.fillText('S', -30, 5);
        x.restore();
    }

    let tick = 0;
    function updateChart(r, w) {
        tick++;
        if(tick % 5 === 0) { 
            chart.data.labels.push('');
            chart.data.datasets[0].data.push(r);
            chart.data.datasets[1].data.push(w);
            if(chart.data.labels.length > 50) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
                chart.data.datasets[1].data.shift();
            }
            chart.update();
        }
    }

    // --- KONTROL ---
    function setMode(m) {
        mode = m;
        const status = document.getElementById('statusBox');
        if(m === 'motor') {
            status.innerHTML = "Mode: <strong>MOTOR ON</strong>. Menyuplai Energi.";
            status.className = "alert alert-success small text-center";
            if(rpm < 100) rpm = 100;
        } else {
            status.innerHTML = "Mode: <strong>FREE ENERGY</strong>. Input Mati. Cek Pengereman!";
            status.className = "alert alert-warning small text-center";
        }
    }
    
    function resetSim() {
        mode = 'stop';
        rpm = 0;
        chart.data.labels = [];
        chart.data.datasets.forEach(d => d.data = []);
        chart.update();
        drawGen(0,0);
        document.getElementById('dispRPM').innerText = "0 RPM";
    }

    // Listener Update Display Slider
    document.getElementById('inputRPM').addEventListener('input', function(e) {
        document.getElementById('rpmVal').innerText = e.target.value + " RPM";
    });
    document.getElementById('coilTurns').addEventListener('input', function(e) {
        document.getElementById('coilVal').innerText = e.target.value + " Lilitan";
    });

    // Start Loop
    setInterval(updatePhysics, 50);

</script>
</body>
</html>
