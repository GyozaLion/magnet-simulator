<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulator Generator & Hukum Lenz (Advanced)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- PERBAIKAN WARNA TEKS --- */
        body { 
            background-color: #1e1e2f; 
            color: #ffffff; /* Teks utama jadi putih murni */
            font-family: 'Roboto', sans-serif; 
        }
        .card { 
            background-color: #27293d; 
            border: 1px solid #3e3e4a; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            color: #ffffff; /* Paksa semua teks dalam card jadi putih */
        }

        /* Override warna Bootstrap yang terlalu gelap */
        .text-muted { color: #d0d0d0 !important; } /* Teks 'muted' jadi abu terang */
        .text-secondary { color: #e0e0e0 !important; } /* Teks 'secondary' jadi hampir putih */
        label, .form-label, .form-text { color: #ffffff; }

        /* Form Inputs */
        .form-control, .form-select { 
            background-color: #1e1e2f; 
            border: 1px solid #2b3553; 
            color: #ffffff; /* Teks input putih */
        }
        .form-control:focus, .form-select:focus { 
            background-color: #27293d; 
            color: #ffffff; 
            border-color: #e14eca; 
            box-shadow: none;
        }
        /* --------------------------- */

        h1, h2, h3, h4, h5, h6 { color: #ffffff; }
        .text-accent { color: #e14eca; }
        
        /* Dashboard values */
        .metric-value { font-family: 'Courier New', monospace; font-weight: bold; }
        
        /* Table Styling */
        .table-dark { background-color: #27293d; --bs-table-bg: #27293d; }
        .table-dark td, .table-dark th { border-color: #3e3e4a; color: #ffffff; }
        
        /* Animation Canvas */
        #animCanvas { background: #1a1a24; border-radius: 8px; border: 2px solid #333; display: block; margin: 0 auto; }
        
        /* Alert Styling adjustments for dark mode */
        .alert-dark { background-color: #343a40; border-color: #454d55; color: #ffffff; }
    </style>
</head>
<body>

<div class="container-fluid py-4">
    <div class="row mb-3">
        <div class="col-12 text-center">
            <h2><i class="fas fa-bolt text-accent"></i> Simulator Fisika Elektromagnetik</h2>
            <p class="text-secondary">Pembuktian Hukum Kekekalan Energi & Hukum Lenz pada Generator</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3">
            <div class="card p-3 mb-3">
                <h5 class="text-accent">Konfigurasi Alat</h5>
                <hr class="border-secondary">
                
                <div class="mb-3">
                    <label class="small">Kekuatan Magnet (Flux Density B)</label>
                    <select id="magnetType" class="form-select form-select-sm">
                        <option value="0.2">Magnet Keramik (0.2 T)</option>
                        <option value="1.2" selected>Neodymium N52 (1.2 T)</option>
                        <option value="5.0">Sci-Fi Super Magnet (5.0 T)</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="small">Jumlah Lilitan (N)</label>
                    <input type="range" class="form-range" id="coilTurns" min="100" max="2000" step="100" value="1000">
                    <div class="text-end small text-accent" id="coilVal">1000 Lilitan</div>
                </div>

                <div class="mb-3">
                    <label class="small">Beban Listrik (Resistor)</label>
                    <input type="number" class="form-control form-control-sm" id="loadResistance" value="20">
                    <div class="text-muted small" style="font-size: 0.75rem;">Semakin kecil Ohm = Beban makin berat.</div>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button class="btn btn-primary" onclick="startSim(true)">
                        <i class="fas fa-motorcycle"></i> Start (Input Motor)
                    </button>
                    <button class="btn btn-danger" onclick="startSim(false)">
                        <i class="fas fa-magic"></i> Start (Mode "Free Energy")
                    </button>
                    <button class="btn btn-outline-secondary text-white" onclick="resetSim()">Reset</button>
                </div>
            </div>

            <div class="card p-3">
                <h6 class="text-danger"><i class="fas fa-exclamation-triangle"></i> Hukum Lenz</h6>
                <p class="small text-muted" style="text-align: justify;">
                    "Arah arus induksi sedemikian rupa sehingga medan magnet yang dihasilkannya <b>melawan</b> perubahan fluks magnetik yang menimbulkannya." <br><br>
                    Artinya: Generator akan mengerem dirinya sendiri saat menghasilkan listrik.
                </p>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card mb-3 text-center p-2">
                <h6 class="text-start ms-2">Visualisasi Rotor</h6>
                <canvas id="animCanvas" width="400" height="300"></canvas>
            </div>

            <div class="card p-2">
                <canvas id="mainChart" style="max-height: 250px;"></canvas>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card p-3 h-100">
                <h5 class="text-accent">Live Telemetry</h5>
                <hr class="border-secondary">
                
                <div class="table-responsive">
                    <table class="table table-dark table-sm table-hover small">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th class="text-end">Nilai</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>RPM Rotor</td>
                                <td class="text-end text-warning metric-value" id="dispRPM">0</td>
                            </tr>
                            <tr>
                                <td>Freq. Sudut (&omega;)</td>
                                <td class="text-end metric-value" id="dispOmega">0 rad/s</td>
                            </tr>
                            <tr><td colspan="2" class="text-secondary" style="font-size: 0.7rem;">--- KELISTRIKAN ---</td></tr>
                            <tr>
                                <td>Tegangan (V)</td>
                                <td class="text-end text-info metric-value" id="dispVolt">0.0 V</td>
                            </tr>
                            <tr>
                                <td>Arus (Ampere)</td>
                                <td class="text-end text-info metric-value" id="dispAmp">0.0 A</td>
                            </tr>
                            <tr>
                                <td>Output Power</td>
                                <td class="text-end text-success metric-value" id="dispWatt">0.0 W</td>
                            </tr>
                            <tr><td colspan="2" class="text-secondary" style="font-size: 0.7rem;">--- GAYA HAMBAT (LOSS) ---</td></tr>
                            <tr>
                                <td>Torsi Magnet (Lenz)</td>
                                <td class="text-end text-danger metric-value" id="dispTorque">0.0 Nm</td>
                            </tr>
                            <tr>
                                <td>Mech. Loss (Gesek)</td>
                                <td class="text-end text-danger metric-value" id="dispFriction">0.0 W</td>
                            </tr>
                            <tr style="border-top: 2px solid white;">
                                <td><strong>NET POWER</strong></td>
                                <td class="text-end metric-value" id="dispNet">0.0 W</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-dark small mt-2" id="statusLog">
                    Status: <strong>Ready</strong>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    /* --- KONFIGURASI GRAFIK --- */
    Chart.defaults.color = '#ffffff'; // Ubah warna default font chart jadi putih
    Chart.defaults.borderColor = '#444444'; // Ubah warna garis grid

    const ctx = document.getElementById('mainChart').getContext('2d');
    const mainChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                { label: 'RPM', data: [], borderColor: '#ffcd56', borderWidth: 2, yAxisID: 'y' },
                { label: 'Power Output (Watt)', data: [], borderColor: '#4bc0c0', borderWidth: 2, yAxisID: 'y1' }
            ]
        },
        options: {
            responsive: true,
            animation: false,
            scales: {
                x: { display: false },
                y: { type: 'linear', display: true, position: 'left', title: {display: true, text: 'RPM', color: 'white'} },
                y1: { type: 'linear', display: true, position: 'right', grid: {drawOnChartArea: false}, title: {display: true, text: 'Watts', color: 'white'} }
            },
            plugins: { legend: { labels: { color: 'white' } } }
        }
    });

    /* --- VARIABEL FISIKA --- */
    let timer = null;
    let timeStep = 0.05; // detik
    let currentTime = 0;
    
    // State Generator
    let rpm = 0;
    let angle = 0; // Sudut rotor (untuk animasi)
    let isMotorOn = false;
    
    // Konstanta Fisika
    const coilArea = 0.02; // m^2 (Luas penampang kumparan)
    const inertia = 0.08; // kg.m^2 (Berat/Inersia Rotor)
    const frictionCoeff = 0.002; // Koefisien gesek udara/bearing

    /* --- FUNGSI UTAMA --- */
    function updatePhysics() {
        // Ambil input user
        const B = parseFloat(document.getElementById('magnetType').value);
        const N = parseInt(document.getElementById('coilTurns').value);
        const R_load = parseFloat(document.getElementById('loadResistance').value);
        const R_internal = N * 0.005; // Resistansi kabel dalam kumparan (0.005 ohm per lilitan)
        const R_total = R_load + R_internal;

        // 1. Hitung Kecepatan Sudut (Omega)
        let omega = (rpm * 2 * Math.PI) / 60; // rad/s

        // 2. Hitung Tegangan Induksi (Back EMF / Generated Voltage)
        let voltage = (N * B * coilArea * omega) * 0.637; // 0.637 adalah rata-rata sinewave

        // 3. Hitung Arus (Ohm's Law)
        let current = voltage / R_total;

        // 4. Hitung Daya Output (P = I^2 * R_load)
        let powerOut = current * current * R_load;

        // 5. Hitung TORSI LAWAN (LENZ LAW - Counter Torque)
        let torqueMagnetic = 0;
        if(omega > 0) {
            torqueMagnetic = (current * current * R_total) / omega;
        }

        // 6. Torsi Gesekan
        let torqueFriction = frictionCoeff * omega;

        // 7. Kalkulasi Perubahan RPM
        if (isMotorOn) {
            // Mode Motor: RPM dijaga konstan oleh input energi luar
            rpm = 3000 + (Math.random() * 20 - 10);
        } else {
            // Mode Free Energy: Tidak ada input.
            let totalCounterTorque = torqueMagnetic + torqueFriction;
            let alpha = totalCounterTorque / inertia;
            omega = omega - (alpha * timeStep);
            if(omega < 0) omega = 0;
            rpm = (omega * 60) / (2 * Math.PI);
        }

        // --- UPDATE DATA TELEMETRY ---
        document.getElementById('dispRPM').innerText = rpm.toFixed(0);
        document.getElementById('dispOmega').innerText = omega.toFixed(1) + " rad/s";
        document.getElementById('dispVolt').innerText = voltage.toFixed(2) + " V";
        document.getElementById('dispAmp').innerText = current.toFixed(2) + " A";
        document.getElementById('dispWatt').innerText = powerOut.toFixed(2) + " W";
        document.getElementById('dispTorque').innerText = torqueMagnetic.toFixed(4) + " Nm";
        document.getElementById('dispFriction').innerText = (torqueFriction * omega).toFixed(2) + " W";
        
        let netPower = isMotorOn ? (powerOut + (torqueFriction*omega) + (current*current*R_internal)) : -powerOut;
        document.getElementById('dispNet').innerText = (isMotorOn ? "Input: " : "Drain: ") + Math.abs(netPower).toFixed(2) + " W";

        // Update Log status jika berhenti
        if(rpm < 1 && !isMotorOn && timer) {
            clearInterval(timer);
            document.getElementById('statusLog').innerHTML = `<span class='text-danger'>SIMULASI BERHENTI.</span> Energi kinetik habis dikonversi menjadi panas & listrik.`;
            document.getElementById('statusLog').className = "alert alert-danger small mt-2";
        }

        // --- UPDATE CHART ---
        currentTime += timeStep;
        if (currentTime % 0.2 < 0.06) { 
            addDataToChart(currentTime.toFixed(1), rpm, powerOut);
        }

        // --- UPDATE ANIMASI ---
        angle += omega * timeStep; 
        drawGenerator(angle, current);
    }

    function drawGenerator(rotationAngle, currentFlow) {
        const cvs = document.getElementById('animCanvas');
        const cx = cvs.getContext('2d');
        const w = cvs.width;
        const h = cvs.height;
        const cxC = w/2;
        const cyC = h/2;

        cx.clearRect(0, 0, w, h);

        // 1. Gambar Stator (Diam)
        cx.beginPath();
        cx.arc(cxC, cyC, 80, 0, 2 * Math.PI);
        cx.lineWidth = 10;
        cx.strokeStyle = '#555'; // Sedikit lebih terang
        cx.stroke();

        // 2. Gambar Kumparan (Coils)
        let coilColor = currentFlow > 0.5 ? `rgba(0, 255, 0, ${Math.min(currentFlow/5, 1)})` : '#666';
        if(currentFlow > 5) coilColor = '#e14eca'; 
        
        cx.fillStyle = coilColor;
        cx.fillRect(cxC - 95, cyC - 20, 30, 40);
        cx.fillRect(cxC + 65, cyC - 20, 30, 40);
        
        // Label Stator (PUTIH)
        cx.fillStyle = '#ffffff'; 
        cx.font = '12px Arial';
        cx.fillText("Stator Coil", cxC - 95, cyC - 30);

        // 3. Gambar Rotor (Berputar)
        cx.save();
        cx.translate(cxC, cyC);
        cx.rotate(rotationAngle);

        cx.fillStyle = '#ccc'; // Poros lebih terang
        cx.fillRect(-60, -15, 120, 30);

        cx.fillStyle = '#ff4444';
        cx.fillRect(20, -15, 40, 30);
        cx.fillStyle = 'white';
        cx.fillText("N", 35, 5);

        cx.fillStyle = '#4444ff';
        cx.fillRect(-60, -15, 40, 30);
        cx.fillStyle = 'white';
        cx.fillText("S", -45, 5);

        cx.restore();

        // 4. Efek Kilat
        if(currentFlow > 1) {
            cx.strokeStyle = `rgba(255, 255, 0, ${Math.random()})`;
            cx.lineWidth = 2;
            cx.beginPath();
            cx.moveTo(cxC - 65, cyC);
            cx.lineTo(cxC + 65, cyC);
            cx.stroke();
        }
    }

    function addDataToChart(label, dataRPM, dataWatt) {
        mainChart.data.labels.push(label);
        mainChart.data.datasets[0].data.push(dataRPM);
        mainChart.data.datasets[1].data.push(dataWatt);

        if (mainChart.data.labels.length > 50) {
            mainChart.data.labels.shift();
            mainChart.data.datasets[0].data.shift();
            mainChart.data.datasets[1].data.shift();
        }
        mainChart.update();
    }

    function startSim(motor) {
        resetSim();
        isMotorOn = motor;
        rpm = 3000; 
        
        document.getElementById('statusLog').className = motor ? "alert alert-primary small mt-2" : "alert alert-warning small mt-2";
        document.getElementById('statusLog').innerHTML = motor ? 
            "Mode: <strong>Motor Driven</strong>. Energi input terus diberikan." : 
            "Mode: <strong>Free Energy Test</strong>. Input dimatikan. Mengandalkan inersia.";

        timer = setInterval(updatePhysics, 50); 
    }

    function resetSim() {
        clearInterval(timer);
        rpm = 0;
        angle = 0;
        currentTime = 0;
        isMotorOn = false;
        
        mainChart.data.labels = [];
        mainChart.data.datasets.forEach((dataset) => { dataset.data = []; });
        mainChart.update();
        
        drawGenerator(0, 0);
        document.getElementById('dispRPM').innerText = "0";
        document.getElementById('dispVolt').innerText = "0.0 V";
        document.getElementById('dispTorque').innerText = "0.0 Nm";
        document.getElementById('statusLog').innerHTML = "Status: <strong>Ready</strong>";
        document.getElementById('statusLog').className = "alert alert-dark small mt-2";
    }

    document.getElementById('coilTurns').addEventListener('input', (e) => {
        document.getElementById('coilVal').innerText = e.target.value + " Lilitan";
    });
    
    // Set initial colors for Chart.js
    Chart.defaults.color = '#ffffff';
    Chart.defaults.borderColor = '#555';
    
    drawGenerator(0, 0);

</script>
</body>
</html>
